<div class="dashboard-animation w-full shadow-xl ring-1 ring-slate-300 rounded-xl overflow-hidden">
  <div class="relative">
    <div id="dashboard-container" class="bg-white p-6 relative">
      <div class="flex justify-between items-center mb-6 transition-all duration-900" id="dashboard-header">
        <div>
          <h3 class="text-xl font-medium text-gray-400" id="dashboard-title">Hallo Geschäftsführer</h3>
          <p class="text-gray-400 text-sm" id="dashboard-subtitle">Unoptimierte Geschäftsansicht</p>
        </div>
        <div class="text-gray-400 text-sm">
          <span id="optimization-score">0</span>/8 KI-Optimierungen aktiv
        </div>
      </div>

      <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <div id="kpi-revenue" class="bg-gray-100 p-4 rounded-lg transition-all duration-900">
          <div class="text-gray-400 text-sm mb-1" id="kpi-revenue-change">+0% ggü. VJ</div>
          <div class="text-2xl font-bold text-gray-500" id="kpi-revenue-value">€2.4M</div>
          <div class="text-sm text-gray-400">Umsatz</div>
        </div>

        <div id="kpi-satisfaction" class="bg-gray-100 p-4 rounded-lg transition-all duration-900">
          <div class="text-gray-400 text-sm mb-1" id="kpi-satisfaction-change">+0% ggü. VJ</div>
          <div class="text-2xl font-bold text-gray-500" id="kpi-satisfaction-value">72%</div>
          <div class="text-sm text-gray-400">Kundenzufriedenheit</div>
        </div>

        <div id="kpi-efficiency" class="bg-gray-100 p-4 rounded-lg transition-all duration-900">
          <div class="text-gray-400 text-sm mb-1" id="kpi-efficiency-change">+0% ggü. VJ</div>
          <div class="text-2xl font-bold text-gray-500" id="kpi-efficiency-value">65%</div>
          <div class="text-sm text-gray-400">Effizienz</div>
        </div>

        <div id="kpi-innovation" class="bg-gray-100 p-4 rounded-lg transition-all duration-900">
          <div class="text-gray-400 text-sm mb-1" id="kpi-innovation-change">+0 Pkt.</div>
          <div class="text-2xl font-bold text-gray-500" id="kpi-innovation-value">43</div>
          <div class="text-sm text-gray-400">Innovationsindex</div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
        <div id="chart-performance" class="bg-gray-100 p-4 rounded-lg h-48 transition-all duration-900">
          <h4 class="text-gray-500 font-medium mb-2">Leistungskennzahlen</h4>
          <div class="relative h-32">
            <svg class="w-full h-full" viewBox="0 0 300 100" preserveAspectRatio="none">
              <line x1="0" y1="25" x2="300" y2="25" stroke="#e5e7eb" stroke-width="1" />
              <line x1="0" y1="50" x2="300" y2="50" stroke="#e5e7eb" stroke-width="1" />
              <line x1="0" y1="75" x2="300" y2="75" stroke="#e5e7eb" stroke-width="1" />

              <polyline id="base-performance-line"
                points="0,70 30,65 60,68 90,60 120,65 150,62 180,70 210,65 240,68 270,64 300,66"
                fill="none"
                stroke="#9ca3af"
                stroke-width="2"
                class="transition-all duration-700 ease-in-out"
              />

              <polyline id="data-analytics-line"
                points="0,70 30,60 60,55 90,45 120,40 150,35 180,30 210,25 240,30 270,25 300,20"
                fill="none"
                stroke="#3b82f6"
                stroke-width="2"
                opacity="0"
                class="transition-all duration-700 ease-in-out"
              />

              <polyline id="process-automation-line"
                points="0,70 30,65 60,55 90,50 120,45 150,40 180,35 210,30 240,25 270,20 300,15"
                fill="none"
                stroke="#10b981"
                stroke-width="2"
                opacity="0"
                class="transition-all duration-700 ease-in-out"
              />
            </svg>

            <div class="absolute bottom-0 left-0 text-xs text-gray-400">Q1</div>
            <div class="absolute bottom-0 right-0 text-xs text-gray-400">Q4</div>
            <div class="absolute top-0 right-0 text-xs text-gray-400" id="performance-max-value">50%</div>
          </div>
        </div>

        <div id="chart-market" class="bg-gray-100 p-4 rounded-lg h-48 transition-all duration-900">
          <h4 class="text-gray-500 font-medium mb-2">Marktanalyse</h4>
          <div class="relative h-32">
            <div class="grid grid-cols-4 gap-1 h-full">
              <div class="flex flex-col justify-end">
                <div class="text-xs text-gray-400 text-center mb-1">Wettbewerber</div>
                <div id="market-bar-1" class="bg-gray-300 w-full transition-all duration-700 ease-in-out" style="height: 40%"></div>
              </div>
              <div class="flex flex-col justify-end">
                <div class="text-xs text-gray-400 text-center mb-1">Ihr Unternehmen</div>
                <div id="market-bar-2" class="bg-gray-400 w-full transition-all duration-700 ease-in-out" style="height: 30%"></div>
              </div>
              <div class="flex flex-col justify-end">
                <div class="text-xs text-gray-400 text-center mb-1">Marktanteil</div>
                <div id="market-bar-3" class="bg-gray-300 w-full transition-all duration-700 ease-in-out" style="height: 25%"></div>
              </div>
              <div class="flex flex-col justify-end">
                <div class="text-xs text-gray-400 text-center mb-1">Wachstumsrate</div>
                <div id="market-bar-4" class="bg-gray-300 w-full transition-all duration-700 ease-in-out" style="height: 20%"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
        <div id="activity-feed" class="bg-gray-100 p-4 rounded-lg transition-all duration-900">
          <h4 class="text-gray-500 font-medium mb-2">Aktivitätsfeed</h4>
          <div class="relative">
            <div id="activity-messages" class="space-y-2 h-[160px] overflow-hidden">
              <div class="p-2 bg-gray-200 rounded text-sm text-gray-500 transition-all duration-900">Quartalsfinanzbericht wurde erstellt</div>
              <div class="p-2 bg-gray-200 rounded text-sm text-gray-500 transition-all duration-900">Marketingkampagnenergebnisse aktualisiert</div>
              <div class="p-2 bg-gray-200 rounded text-sm text-gray-500 transition-all duration-900">3 Teamaufgaben erfordern Überprüfung</div>
              <div class="p-2 bg-gray-200 rounded text-sm text-gray-500 transition-all duration-900">Neues Support-Ticket #45892 erstellt</div>
            </div>
            <div class="absolute bottom-0 left-0 right-0 h-16 pointer-events-none fade-overlay" id="activity-fade"></div>
          </div>
        </div>

        <div id="team-status" class="bg-gray-100 p-4 rounded-lg transition-all duration-900">
          <h4 class="text-gray-500 font-medium mb-2">Teamstatus</h4>
          <div class="relative">
            <div id="team-messages" class="space-y-2 h-[160px] overflow-hidden">
              <div class="p-2 bg-gray-200 rounded text-sm text-gray-500 transition-all duration-900">15 Teammitglieder derzeit aktiv</div>
              <div class="p-2 bg-gray-200 rounded text-sm text-gray-500 transition-all duration-900">Projekt Horizont: 68% abgeschlossen</div>
              <div class="p-2 bg-gray-200 rounded text-sm text-gray-500 transition-all duration-900">Teammeeting für 14:00 Uhr geplant</div>
              <div class="p-2 bg-gray-200 rounded text-sm text-gray-500 transition-all duration-900">4 Urlaubsanträge warten auf Genehmigung</div>
            </div>
            <div class="absolute bottom-0 left-0 right-0 h-16 pointer-events-none fade-overlay" id="team-fade"></div>
          </div>
        </div>
      </div>
    </div>

    <div id="optimization-complete" class="absolute inset-0 bg-blue-600 bg-opacity-90 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-500">
      <div class="text-center text-white">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <h3 class="text-2xl font-bold mb-2">Vollständig KI-optimiert!</h3>
        <p class="max-w-sm mx-auto">Ihr Unternehmen ist nun für die KI-Zukunft gerüstet und bereit, neue Höhen zu erreichen.</p>
      </div>
    </div>
  </div>

  <div class="bg-slate-100 p-4">
    <h4 class="text-center text-blue-950 font-semibold mb-4">KI-Optimierungen aktivieren</h4>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
      <button id="btn-data-analytics" class="optimization-btn p-2 bg-white hover:bg-blue-50 rounded-lg border border-slate-300 text-blue-950 text-sm transition-all">
        <div class="font-medium">Datenanalyse</div>
      </button>
      <button id="btn-process-automation" class="optimization-btn p-2 bg-white hover:bg-blue-50 rounded-lg border border-slate-300 text-blue-950 text-sm transition-all">
        <div class="font-medium">Prozessautomatisierung</div>
      </button>
      <button id="btn-customer-insights" class="optimization-btn p-2 bg-white hover:bg-blue-50 rounded-lg border border-slate-300 text-blue-950 text-sm transition-all">
        <div class="font-medium">Kundeneinblicke</div>
      </button>
      <button id="btn-predictive-analytics" class="optimization-btn p-2 bg-white hover:bg-blue-50 rounded-lg border border-slate-300 text-blue-950 text-sm transition-all">
        <div class="font-medium">Prädiktive Analyse</div>
      </button>
      <button id="btn-resource-optimization" class="optimization-btn p-2 bg-white hover:bg-blue-50 rounded-lg border border-slate-300 text-blue-950 text-sm transition-all">
        <div class="font-medium">Ressourcenoptimierung</div>
      </button>
      <button id="btn-market-intelligence" class="optimization-btn p-2 bg-white hover:bg-blue-50 rounded-lg border border-slate-300 text-blue-950 text-sm transition-all">
        <div class="font-medium">Marktintelligenz</div>
      </button>
      <button id="btn-talent-ai" class="optimization-btn p-2 bg-white hover:bg-blue-50 rounded-lg border border-slate-300 text-blue-950 text-sm transition-all">
        <div class="font-medium">Talent-KI</div>
      </button>
      <button id="btn-innovation-engine" class="optimization-btn p-2 bg-white hover:bg-blue-50 rounded-lg border border-slate-300 text-blue-950 text-sm transition-all">
        <div class="font-medium">Innovationsmotor</div>
      </button>
    </div>
  </div>
</div>

<style>
  .fade-overlay {
    background-image: linear-gradient(to bottom, rgba(243, 244, 246, 0) 0%, rgba(243, 244, 246, 1) 100%);
  }
</style>

<script>
  const optimizations = {
    dataAnalytics: false,
    processAutomation: false,
    customerInsights: false,
    predictiveAnalytics: false,
    resourceOptimization: false,
    marketIntelligence: false,
    talentAI: false,
    innovationEngine: false
  };

  const buttons: Record<string, HTMLElement | null> = {
    dataAnalytics: document.getElementById('btn-data-analytics'),
    processAutomation: document.getElementById('btn-process-automation'),
    customerInsights: document.getElementById('btn-customer-insights'),
    predictiveAnalytics: document.getElementById('btn-predictive-analytics'),
    resourceOptimization: document.getElementById('btn-resource-optimization'),
    marketIntelligence: document.getElementById('btn-market-intelligence'),
    talentAI: document.getElementById('btn-talent-ai'),
    innovationEngine: document.getElementById('btn-innovation-engine')
  };

  const elements = {
    scoreDisplay: document.getElementById('optimization-score'),
    completeOverlay: document.getElementById('optimization-complete'),
    dashboardHeader: document.getElementById('dashboard-header'),
    dashboardTitle: document.getElementById('dashboard-title'),
    dashboardSubtitle: document.getElementById('dashboard-subtitle'),
    kpiRevenue: document.getElementById('kpi-revenue'),
    kpiRevenueChange: document.getElementById('kpi-revenue-change'),
    kpiRevenueValue: document.getElementById('kpi-revenue-value'),
    kpiSatisfaction: document.getElementById('kpi-satisfaction'),
    kpiSatisfactionChange: document.getElementById('kpi-satisfaction-change'),
    kpiSatisfactionValue: document.getElementById('kpi-satisfaction-value'),
    kpiEfficiency: document.getElementById('kpi-efficiency'),
    kpiEfficiencyChange: document.getElementById('kpi-efficiency-change'),
    kpiEfficiencyValue: document.getElementById('kpi-efficiency-value'),
    kpiInnovation: document.getElementById('kpi-innovation'),
    kpiInnovationChange: document.getElementById('kpi-innovation-change'),
    kpiInnovationValue: document.getElementById('kpi-innovation-value'),
    chartPerformance: document.getElementById('chart-performance'),
    chartMarket: document.getElementById('chart-market'),
    activityFeed: document.getElementById('activity-feed'),
    teamStatus: document.getElementById('team-status'),
    activityMessages: document.getElementById('activity-messages'),
    teamMessages: document.getElementById('team-messages'),
    activityFade: document.getElementById('activity-fade'),
    teamFade: document.getElementById('team-fade'),
    performanceMaxValue: document.getElementById('performance-max-value')
  };


  const activityMessages = {
    default: [
      "Quartalsfinanzbericht wurde erstellt",
      "Marketingkampagnenergebnisse aktualisiert",
      "3 Teamaufgaben erfordern Überprüfung",
      "Neues Support-Ticket #45892 erstellt",
      "Wöchentliches Statusmeeting geplant",
      "Kundenfeedbackbericht verfügbar"
    ],
    dataAnalytics: [
      "Datenanalyse zeigt 23% Umsatzchance im EU-Markt",
      "Kundensegmentierungsmodell identifizierte 3 neue Zielgruppen",
      "Prädiktives Modell schlägt 15% Bestandsoptimierung vor",
      "Datenanomalie im Marketingbudget erkannt - Untersuchung empfohlen"
    ],
    processAutomation: [
      "Workflow-Automatisierung sparte diese Woche 128 Arbeitsstunden",
      "Automatisierte Rechnungsverarbeitung abgeschlossen - 99,7% Genauigkeit",
      "Prozessengpass im Genehmigungsworkflow identifiziert",
      "Intelligente Planung optimierte Produktion um 17%"
    ],
    customerInsights: [
      "Kundenstimmungsanalyse zeigt 89% positives Feedback",
      "Neues Kundenverhaltensmuster identifiziert - Chancenalarm",
      "Abwanderungsprognose markiert 15 Hochrisikokonten",
      "Kundenerlebnismapping schlägt neuen Kontaktpunkt vor"
    ],
    predictiveAnalytics: [
      "Umsatzprognose aktualisiert: +8% Wachstum für Q4 prognostiziert",
      "Prädiktive Wartungswarnung: Gerät #5 benötigt Inspektion",
      "Markttrendanalyse empfiehlt Erhöhung der Werbeausgaben um 15%",
      "Verkaufsprognosemodell empfiehlt Fokus auf Unternehmenssegment",
      "KI prognostiziert 32% Steigerung des Kundenlebenszeitwerts mit neuem Treueprogramm",
      "Prädiktive KI erkennt aufkommenden Markttrend - Chancenbriefing bereit",
      "Zukünftige Cashflow-Simulation abgeschlossen - 3 Optimierungsszenarien verfügbar",
      "KI prognostiziert 18% Kostenreduzierung durch prädiktives Bestandsmanagement",
      "Lieferkettenunterbrechung für Q3 vorhergesagt - Minderungsplan vorgeschlagen",
      "Kundenverhaltensprognose zeigt neue Segmentchance",
      "Prädiktives Einstellungsmodell schlägt Umstrukturierung der Verkaufsgebiete vor",
      "Zukünftige Produktnachfrageprognose bereit - Produktionsplanung empfohlen"
    ],
    resourceOptimization: [
      "Ressourcenzuweisung optimiert - 12% Effizienzgewinn",
      "Dynamisches Personalmodell schlägt Anpassung der Teamzusammensetzung vor",
      "Kostenoptimierungsalgorithmus identifizierte monatliche Einsparungen von 45.000 €",
      "Energieverbrauchsoptimierung reduzierte Gemeinkosten um 8%"
    ],
    marketIntelligence: [
      "Wettbewerber startete neuen Service - Bedrohungsanalyse verfügbar",
      "Marktlücke im Unternehmenssegment identifiziert",
      "Preisstrategieempfehlung: Premium-Stufe um 5% erhöhen",
      "Neue Markteinstiegschance erkannt - Analyse bereit"
    ],
    talentAI: [
      "KI-gestützte Kompetenzlückenanalyse für Ingenieurteam abgeschlossen",
      "Leistungsprognosemodell empfiehlt Beförderung für 3 Mitarbeiter",
      "Teamzusammensetzungsanalyse empfiehlt Umstrukturierung",
      "Talentbindungsrisiko für Schlüsselpositionen identifiziert"
    ],
    innovationEngine: [
      "Innovationsbewertung identifizierte 2 hochpotenzielle Projekte",
      "Patentanalyse schlägt defensive Anmeldungsmöglichkeit vor",
      "Branchenübergreifende Innovationsmuster deuten auf neue Produktfunktion hin",
      "F&E-Optimierungsmodell schlägt Umverteilung von Ressourcen vor"
    ]
  };

  const teamMessages = {
    default: [
      "15 Teammitglieder derzeit aktiv",
      "Projekt Horizont: 68% abgeschlossen",
      "Teammeeting für 14:00 Uhr geplant",
      "4 Urlaubsanträge warten auf Genehmigung",
      "5 überfällige Aufgaben in allen Abteilungen",
      "Sprint-Planung für morgen angesetzt"
    ],
    dataAnalytics: [
      "Data-Science-Team analysiert Kundenverhaltensmuster",
      "Analytics-Dashboard zeigt Echtzeit-KPIs für alle Teams",
      "Teamleistungskennzahlen zeigen 15% Verbesserung",
      "Datengestützte Zielsetzung für alle Abteilungen abgeschlossen"
    ],
    processAutomation: [
      "Automatisierter Workflow erhöhte Teamdurchsatz um 34%",
      "Intelligente Aufgabenzuweisung gleicht Teamarbeitsbelastung aus",
      "Prozesseffizienzwert auf 87% verbessert",
      "Automatisierung reduzierte manuelle Aufgaben für Support-Team um 45%"
    ],
    customerInsights: [
      "Kundenerfolgsteam priorisiert hochwertige Konten",
      "Team erhält Echtzeit-Kundenfeedback-Benachrichtigungen",
      "Kundenorientierte Leistungskennzahlen für alle Teams aktiv",
      "Teamfokus auf Verbesserung des Kunden-Onboardings verlagert"
    ],
    predictiveAnalytics: [
      "Projektabschlussprognose: 3 Tage vor Zeitplan",
      "Teamkapazitätsprognose deutet auf zusätzlichen Ressourcenbedarf im nächsten Monat hin",
      "Leistungsprognosen zeigen Coaching-Möglichkeiten auf",
      "Team-Burnout-Risikobewertung: niedriges Risiko identifiziert"
    ],
    resourceOptimization: [
      "Teamressourcenzuweisung basierend auf Fähigkeiten optimiert",
      "Intelligente Planung reduzierte Überstunden um 27%",
      "Zeiterfassungsanalyse zeigt verbesserte Fokuszeit",
      "Ressourcennutzung auf optimalem Niveau in allen Abteilungen"
    ],
    marketIntelligence: [
      "Team auf neueste Marktinformationen abgestimmt",
      "Wettbewerbsinformationsbriefing für Teams geplant",
      "Marktorientierte Ziele für Produktteams aktualisiert",
      "Teams reagieren auf Wettbewerbsbewegungen im Markt"
    ],
    talentAI: [
      "KI-abgestimmte Mentoring-Paare zeigen starkes Engagement",
      "Teamzusammensetzung für aktuelles Projektportfolio optimiert",
      "KI-empfohlene Schulungen zur Schließung von Kompetenzlücken zugewiesen",
      "Karriereentwicklungspfade für alle Teammitglieder identifiziert"
    ],
    innovationEngine: [
      "Innovationsteams erkunden 3 neue Chancenbereiche",
      "Funktionsübergreifende Teams basierend auf Innovationspotenzial gebildet",
      "Ideenmanagement-Plattform zeigt 34 neue Einreichungen",
      "Team-Innovationswerte stiegen in diesem Quartal um 28%"
    ]
  };

  const messageInterval = 3000;
  let messageIntervalId: number | null = null;

  function updateDashboard() {
    const activeCount = Object.values(optimizations).filter(value => value).length;
    if (elements.scoreDisplay) elements.scoreDisplay.textContent = String(activeCount);

    if (optimizations.dataAnalytics) {
      if (elements.chartPerformance) {
        elements.chartPerformance.classList.add('bg-blue-50');
        elements.chartPerformance.classList.remove('bg-gray-100');
        const h4 = elements.chartPerformance.querySelector('h4');
        if (h4) {
          h4.classList.add('text-blue-600');
          h4.classList.remove('text-gray-500');
        }
      }
      if (elements.kpiRevenue) elements.kpiRevenue.classList.add('bg-blue-50');
      if (elements.kpiRevenue) elements.kpiRevenue.classList.remove('bg-gray-100');
      if (elements.kpiRevenueValue) {
        elements.kpiRevenueValue.textContent = '€2.7M';
        elements.kpiRevenueValue.classList.add('text-blue-700');
      }
      if (elements.kpiRevenueChange) {
        elements.kpiRevenueChange.textContent = '+12% ggü. VJ';
        elements.kpiRevenueChange.classList.add('text-blue-600');
      }
      const daLine = document.getElementById('data-analytics-line');
      if (daLine) daLine.setAttribute('opacity', '1');
      const bpLine = document.getElementById('base-performance-line');
      if (bpLine) bpLine.setAttribute('opacity', '0.3');
      if (elements.performanceMaxValue) elements.performanceMaxValue.textContent = '85%';
    } else {
      if (elements.chartPerformance) {
        elements.chartPerformance.classList.remove('bg-blue-50');
        elements.chartPerformance.classList.add('bg-gray-100');
        const h4 = elements.chartPerformance.querySelector('h4');
        if (h4) {
          h4.classList.remove('text-blue-600');
          h4.classList.add('text-gray-500');
        }
      }
      if (elements.kpiRevenue) elements.kpiRevenue.classList.remove('bg-blue-50');
      if (elements.kpiRevenue) elements.kpiRevenue.classList.add('bg-gray-100');
      if (elements.kpiRevenueValue) {
        elements.kpiRevenueValue.textContent = '€2.4M';
        elements.kpiRevenueValue.classList.remove('text-blue-700');
      }
      if (elements.kpiRevenueChange) {
        elements.kpiRevenueChange.textContent = '+0% ggü. VJ';
        elements.kpiRevenueChange.classList.remove('text-blue-600');
      }
      const daLine = document.getElementById('data-analytics-line');
      if (daLine) daLine.setAttribute('opacity', '0');
      if (!optimizations.processAutomation) {
        const bpLine = document.getElementById('base-performance-line');
        if (bpLine) bpLine.setAttribute('opacity', '1');
        if (elements.performanceMaxValue) elements.performanceMaxValue.textContent = '50%';
      }
    }

    if (optimizations.processAutomation) {
      if (elements.kpiEfficiency) elements.kpiEfficiency.classList.add('bg-green-50');
      if (elements.kpiEfficiency) elements.kpiEfficiency.classList.remove('bg-gray-100');
      if (elements.kpiEfficiencyValue) {
        elements.kpiEfficiencyValue.textContent = '89%';
        elements.kpiEfficiencyValue.classList.add('text-green-700');
      }
      if (elements.kpiEfficiencyChange) {
        elements.kpiEfficiencyChange.textContent = '+24% ggü. VJ';
        elements.kpiEfficiencyChange.classList.add('text-green-600');
      }
      const paLine = document.getElementById('process-automation-line');
      if (paLine) paLine.setAttribute('opacity', '1');
      const bpLine = document.getElementById('base-performance-line');
      if (bpLine) bpLine.setAttribute('opacity', '0.3');
      if (elements.performanceMaxValue) elements.performanceMaxValue.textContent = '85%';
    } else {
      if (elements.kpiEfficiency) elements.kpiEfficiency.classList.remove('bg-green-50');
      if (elements.kpiEfficiency) elements.kpiEfficiency.classList.add('bg-gray-100');
      if (elements.kpiEfficiencyValue) {
        elements.kpiEfficiencyValue.textContent = '65%';
        elements.kpiEfficiencyValue.classList.remove('text-green-700');
      }
      if (elements.kpiEfficiencyChange) {
        elements.kpiEfficiencyChange.textContent = '+0% ggü. VJ';
        elements.kpiEfficiencyChange.classList.remove('text-green-600');
      }
      const paLine = document.getElementById('process-automation-line');
      if (paLine) paLine.setAttribute('opacity', '0');
      if (!optimizations.dataAnalytics) {
        const bpLine = document.getElementById('base-performance-line');
        if (bpLine) bpLine.setAttribute('opacity', '1');
        if (elements.performanceMaxValue) elements.performanceMaxValue.textContent = '50%';
      }
    }

    if (optimizations.customerInsights) {
      if (elements.kpiSatisfaction) elements.kpiSatisfaction.classList.add('bg-purple-50');
      if (elements.kpiSatisfaction) elements.kpiSatisfaction.classList.remove('bg-gray-100');
      if (elements.kpiSatisfactionValue) {
        elements.kpiSatisfactionValue.textContent = '94%';
        elements.kpiSatisfactionValue.classList.add('text-purple-700');
      }
      if (elements.kpiSatisfactionChange) {
        elements.kpiSatisfactionChange.textContent = '+22% ggü. VJ';
        elements.kpiSatisfactionChange.classList.add('text-purple-600');
      }
    } else {
      if (elements.kpiSatisfaction) elements.kpiSatisfaction.classList.remove('bg-purple-50');
      if (elements.kpiSatisfaction) elements.kpiSatisfaction.classList.add('bg-gray-100');
      if (elements.kpiSatisfactionValue) {
        elements.kpiSatisfactionValue.textContent = '72%';
        elements.kpiSatisfactionValue.classList.remove('text-purple-700');
      }
      if (elements.kpiSatisfactionChange) {
        elements.kpiSatisfactionChange.textContent = '+0% ggü. VJ';
        elements.kpiSatisfactionChange.classList.remove('text-purple-600');
      }
    }

    if (optimizations.predictiveAnalytics) {
      const predictiveLine = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
      predictiveLine.setAttribute('id', 'predictive-line');
      predictiveLine.setAttribute('points', '300,20 330,15 360,10');
      predictiveLine.setAttribute('stroke', '#f59e0b');
      predictiveLine.setAttribute('stroke-width', '2');
      predictiveLine.setAttribute('stroke-dasharray', '5,5');
      predictiveLine.setAttribute('fill', 'none');

      const existingPredictiveLine = document.getElementById('predictive-line');
      if (!existingPredictiveLine && elements.chartPerformance) {
        const svg = elements.chartPerformance.querySelector('svg');
        if (svg) svg.appendChild(predictiveLine);
      }

      const predictiveLabel = document.createElement('div');
      predictiveLabel.setAttribute('id', 'predictive-label');
      predictiveLabel.classList.add('absolute', 'top-0', 'right-12', 'text-xs', 'text-amber-500');
      predictiveLabel.textContent = 'Prädiktiv';

      const existingPredictiveLabel = document.getElementById('predictive-label');
      if (!existingPredictiveLabel && elements.chartPerformance) {
        const rel = elements.chartPerformance.querySelector('.relative');
        if (rel) rel.appendChild(predictiveLabel);
      }
    }

    if (optimizations.resourceOptimization) {
      if (elements.dashboardTitle) {
        elements.dashboardTitle.textContent = 'Hey CEO';
        elements.dashboardTitle.classList.add('text-teal-700');
        elements.dashboardTitle.classList.remove('text-gray-400');
      }
      if (elements.dashboardSubtitle) {
        elements.dashboardSubtitle.textContent = 'Optimierte Ressourcenansicht';
        elements.dashboardSubtitle.classList.add('text-teal-600');
        elements.dashboardSubtitle.classList.remove('text-gray-400');
      }
    } else {
      if (elements.dashboardTitle) {
        elements.dashboardTitle.textContent = 'Hallo Geschäftsführer';
        elements.dashboardTitle.classList.remove('text-teal-700');
        elements.dashboardTitle.classList.add('text-gray-400');
      }
      if (elements.dashboardSubtitle) {
        elements.dashboardSubtitle.textContent = 'Unoptimierte Geschäftsansicht';
        elements.dashboardSubtitle.classList.remove('text-teal-600');
        elements.dashboardSubtitle.classList.add('text-gray-400');
      }
    }

    if (optimizations.marketIntelligence) {
      if (elements.chartMarket) {
        elements.chartMarket.classList.add('bg-indigo-50');
        elements.chartMarket.classList.remove('bg-gray-100');
        const h4 = elements.chartMarket.querySelector('h4');
        if (h4) {
          h4.classList.add('text-indigo-700');
          h4.classList.remove('text-gray-500');
        }
      }
      const mb1 = document.getElementById('market-bar-1');
      if (mb1) {
        mb1.style.height = '40%';
        mb1.classList.add('bg-indigo-200');
        mb1.classList.remove('bg-gray-300');
      }
      const mb2 = document.getElementById('market-bar-2');
      if (mb2) {
        mb2.style.height = '65%';
        mb2.classList.add('bg-indigo-500');
        mb2.classList.remove('bg-gray-400');
      }
      const mb3 = document.getElementById('market-bar-3');
      if (mb3) {
        mb3.style.height = '55%';
        mb3.classList.add('bg-indigo-300');
        mb3.classList.remove('bg-gray-300');
      }
      const mb4 = document.getElementById('market-bar-4');
      if (mb4) {
        mb4.style.height = '70%';
        mb4.classList.add('bg-indigo-400');
        mb4.classList.remove('bg-gray-300');
      }
    } else {
      if (elements.chartMarket) {
        elements.chartMarket.classList.remove('bg-indigo-50');
        elements.chartMarket.classList.add('bg-gray-100');
        const h4 = elements.chartMarket.querySelector('h4');
        if (h4) {
          h4.classList.remove('text-indigo-700');
          h4.classList.add('text-gray-500');
        }
      }
      const mb1 = document.getElementById('market-bar-1');
      if (mb1) {
        mb1.style.height = '40%';
        mb1.classList.remove('bg-indigo-200');
        mb1.classList.add('bg-gray-300');
      }
      const mb2 = document.getElementById('market-bar-2');
      if (mb2) {
        mb2.style.height = '30%';
        mb2.classList.remove('bg-indigo-500');
        mb2.classList.add('bg-gray-400');
      }
      const mb3 = document.getElementById('market-bar-3');
      if (mb3) {
        mb3.style.height = '25%';
        mb3.classList.remove('bg-indigo-300');
        mb3.classList.add('bg-gray-300');
      }
      const mb4 = document.getElementById('market-bar-4');
      if (mb4) {
        mb4.style.height = '20%';
        mb4.classList.remove('bg-indigo-400');
        mb4.classList.add('bg-gray-300');
      }
    }

    if (optimizations.talentAI) {
      if (elements.teamStatus) {
        elements.teamStatus.classList.add('bg-green-50');
        elements.teamStatus.classList.remove('bg-gray-100');
        const h4 = elements.teamStatus.querySelector('h4');
        if (h4) {
          h4.classList.add('text-green-700');
          h4.classList.remove('text-gray-500');
        }
      }
    } else {
      if (elements.teamStatus) {
        elements.teamStatus.classList.remove('bg-green-50');
        elements.teamStatus.classList.add('bg-gray-100');
        const h4 = elements.teamStatus.querySelector('h4');
        if (h4) {
          h4.classList.remove('text-green-700');
          h4.classList.add('text-gray-500');
        }
      }
    }

    if (optimizations.innovationEngine) {
      if (elements.kpiInnovation) {
        elements.kpiInnovation.classList.add('bg-cyan-50');
        elements.kpiInnovation.classList.remove('bg-gray-100');
        if (elements.kpiInnovationValue) {
          elements.kpiInnovationValue.textContent = '87';
          elements.kpiInnovationValue.classList.add('text-cyan-700');
        }
        if (elements.kpiInnovationChange) {
          elements.kpiInnovationChange.textContent = '+44 Pkt.';
          elements.kpiInnovationChange.classList.add('text-cyan-600');
        }
      }
    } else {
      if (elements.kpiInnovation) {
        elements.kpiInnovation.classList.remove('bg-cyan-50');
        elements.kpiInnovation.classList.add('bg-gray-100');
        if (elements.kpiInnovationValue) {
          elements.kpiInnovationValue.textContent = '43';
          elements.kpiInnovationValue.classList.remove('text-cyan-700');
        }
        if (elements.kpiInnovationChange) {
          elements.kpiInnovationChange.textContent = '+0 Pkt.';
          elements.kpiInnovationChange.classList.remove('text-cyan-600');
        }
      }
    }

    if (activeCount === 8) {
      if (elements.completeOverlay) {
        elements.completeOverlay.classList.remove('opacity-0', 'pointer-events-none');
        elements.completeOverlay.classList.add('opacity-100');
        setTimeout(() => {
          if (elements.completeOverlay) {
            elements.completeOverlay.classList.add('opacity-0', 'pointer-events-none');
            elements.completeOverlay.classList.remove('opacity-100');
          }
        }, 3000);
      }
    } else {
      if (elements.completeOverlay) {
        elements.completeOverlay.classList.add('opacity-0', 'pointer-events-none');
        elements.completeOverlay.classList.remove('opacity-100');
      }
    }

    Object.entries(optimizations).forEach(([key, value]) => {
      const button = buttons[key];
      if (value) {
        if (button) {
          button.classList.add('bg-blue-600', 'text-white', 'border-blue-700');
          button.classList.remove('bg-white', 'text-blue-950', 'border-slate-300', 'hover:bg-blue-50');
        }
      } else {
        if (button) {
          button.classList.remove('bg-blue-600', 'text-white', 'border-blue-700');
          button.classList.add('bg-white', 'text-blue-950', 'border-slate-300', 'hover:bg-blue-50');
        }
      }
    });

    const isAnyOptimizationActive = Object.values(optimizations).some(value => value);

    if (isAnyOptimizationActive) {
      if (elements.activityFeed) {
        const h4 = elements.activityFeed.querySelector('h4');
        if (h4) {
          h4.textContent = 'Prädiktiver Aktivitätsfeed';
          h4.classList.add('text-amber-700');
          h4.classList.remove('text-blue-700', 'text-gray-500');
        }
        elements.activityFeed.classList.add('bg-amber-50');
        elements.activityFeed.classList.remove('bg-blue-50', 'bg-gray-100');
      }
      if (elements.activityFade) {
        elements.activityFade.style.backgroundImage = 'linear-gradient(to bottom, rgba(254, 243, 199, 0) 0%, rgba(254, 243, 199, 1) 100%)';
      }

      if (!messageIntervalId) {
        startMessageRotation();
      }
    } else {
      if (elements.activityFeed) {
        const h4 = elements.activityFeed.querySelector('h4');
        if (h4) {
          h4.textContent = 'Intelligenter Aktivitätsfeed';
          h4.classList.add('text-blue-700');
          h4.classList.remove('text-amber-700', 'text-gray-500');
        }
        elements.activityFeed.classList.add('bg-blue-50');
        elements.activityFeed.classList.remove('bg-amber-50', 'bg-gray-100');
      }
      if (elements.activityFade) {
        elements.activityFade.style.backgroundImage = 'linear-gradient(to bottom, rgba(239, 246, 255, 0) 0%, rgba(239, 246, 255, 1) 100%)';
      }

      stopMessageRotation();
      setDefaultMessages();
    }

    if (isAnyOptimizationActive) {
      if (elements.teamStatus) {
        elements.teamStatus.classList.add('bg-green-50');
        elements.teamStatus.classList.remove('bg-gray-100');
        const h4 = elements.teamStatus.querySelector('h4');
        if (h4) {
          h4.classList.add('text-green-700');
          h4.classList.remove('text-gray-500');
        }
      }
      if (elements.teamFade) {
        elements.teamFade.style.backgroundImage = 'linear-gradient(to bottom, rgba(240, 253, 244, 0) 0%, rgba(240, 253, 244, 1) 100%)';
      }
    } else {
      if (elements.teamStatus) {
        const h4 = elements.teamStatus.querySelector('h4');
        if (h4) {
          h4.textContent = 'Teamstatus';
          h4.classList.remove('text-green-700');
          h4.classList.add('text-gray-500');
        }
        elements.teamStatus.classList.remove('bg-green-50');
        elements.teamStatus.classList.add('bg-gray-100');
      }
      if (elements.teamFade) {
        elements.teamFade.style.backgroundImage = 'linear-gradient(to bottom, rgba(243, 244, 246, 0) 0%, rgba(243, 244, 246, 1) 100%)';
      }
    }
    updateDisplayedMessages();
  }

  Object.entries(buttons).forEach(([key, button]) => {
    if (button) {
      button.addEventListener('click', () => {
        (optimizations as any)[key] = !(optimizations as any)[key];
        updateDashboard();
      });
    }
  });

  function setDefaultMessages() {
    if (elements.activityMessages) elements.activityMessages.innerHTML = '';

    for (let i = 0; i < 4; i++) {
      const messageElement = document.createElement('div');
      messageElement.className = 'p-2 bg-gray-200 rounded text-sm text-gray-500 transition-all duration-900';
      messageElement.textContent = activityMessages.default[i];
      if (elements.activityMessages) elements.activityMessages.appendChild(messageElement);
    }

    if (elements.teamMessages) elements.teamMessages.innerHTML = '';

    for (let i = 0; i < 4; i++) {
      const messageElement = document.createElement('div');
      messageElement.className = 'p-2 bg-gray-200 rounded text-sm text-gray-500 transition-all duration-900';
      messageElement.textContent = teamMessages.default[i];
      if (elements.teamMessages) elements.teamMessages.appendChild(messageElement);
    }
  }

  function getAvailableMessages() {
    let availableActivityMessages = [...activityMessages.default];
    let availableTeamMessages = [...teamMessages.default];

    if (optimizations.dataAnalytics) {
      availableActivityMessages = availableActivityMessages.concat(activityMessages.dataAnalytics);
      availableTeamMessages = availableTeamMessages.concat(teamMessages.dataAnalytics);
    }

    if (optimizations.processAutomation) {
      availableActivityMessages = availableActivityMessages.concat(activityMessages.processAutomation);
      availableTeamMessages = availableTeamMessages.concat(teamMessages.processAutomation);
    }

    if (optimizations.customerInsights) {
      availableActivityMessages = availableActivityMessages.concat(activityMessages.customerInsights);
      availableTeamMessages = availableTeamMessages.concat(teamMessages.customerInsights);
    }

    if (optimizations.predictiveAnalytics) {
      availableActivityMessages = availableActivityMessages.concat(activityMessages.predictiveAnalytics);
      availableTeamMessages = availableTeamMessages.concat(teamMessages.predictiveAnalytics);
    }

    if (optimizations.resourceOptimization) {
      availableActivityMessages = availableActivityMessages.concat(activityMessages.resourceOptimization);
      availableTeamMessages = availableTeamMessages.concat(teamMessages.resourceOptimization);
    }

    if (optimizations.marketIntelligence) {
      availableActivityMessages = availableActivityMessages.concat(activityMessages.marketIntelligence);
      availableTeamMessages = availableTeamMessages.concat(teamMessages.marketIntelligence);
    }

    if (optimizations.talentAI) {
      availableActivityMessages = availableActivityMessages.concat(activityMessages.talentAI);
      availableTeamMessages = availableTeamMessages.concat(teamMessages.talentAI);
    }

    if (optimizations.innovationEngine) {
      availableActivityMessages = availableActivityMessages.concat(activityMessages.innovationEngine);
      availableTeamMessages = availableTeamMessages.concat(teamMessages.innovationEngine);
    }

    return {
      activity: availableActivityMessages,
      team: availableTeamMessages
    };
  }

  function updateDisplayedMessages() {
    if (!Object.values(optimizations).some(value => value)) {
      return;
    }

    const availableMessages = getAvailableMessages();
    const isAnyOptimizationActive = Object.values(optimizations).some(value => value);

    const activityContainer = elements.activityMessages;
    const currentActivityMessages = activityContainer ? Array.from(activityContainer.children).map(el => el.textContent) : [];

    if (activityContainer && availableMessages.activity.length > 0) {
      const newOptions = availableMessages.activity.filter(msg => !currentActivityMessages.includes(msg));

      if (newOptions.length > 0) {
        const randomIndex = Math.floor(Math.random() * newOptions.length);
        const newMessage = newOptions[randomIndex];

        const messageElement = document.createElement('div');
        messageElement.className = 'p-2 rounded text-sm transition-all duration-900 opacity-0 transform translate-y-[-10px]';

        if (optimizations.predictiveAnalytics && activityMessages.predictiveAnalytics.includes(newMessage)) {
          messageElement.classList.add('bg-amber-100', 'text-amber-700');
        } else if (isAnyOptimizationActive) {
          messageElement.classList.add('bg-blue-100', 'text-blue-700');
        } else {
          messageElement.classList.add('bg-gray-200', 'text-gray-500');
        }

        messageElement.textContent = newMessage;

        if (activityContainer.firstChild) {
          activityContainer.insertBefore(messageElement, activityContainer.firstChild);
        } else {
          activityContainer.appendChild(messageElement);
        }

        setTimeout(() => {
          messageElement.classList.remove('opacity-0', 'transform', 'translate-y-[-10px]');
          messageElement.classList.add('opacity-100');
        }, 50);

        if (activityContainer.children.length > 4) {
          const oldestMessage = activityContainer.lastElementChild;
          if (oldestMessage) {
            oldestMessage.classList.add('opacity-0', 'transform', 'translate-y-[10px]');
            setTimeout(() => {
              oldestMessage.remove();
            }, 300);
          }
        }
      }
    }

    const teamContainer = elements.teamMessages;
    const currentTeamMessages = teamContainer ? Array.from(teamContainer.children).map(el => el.textContent) : [];

    if (teamContainer && availableMessages.team.length > 0) {
      const newOptions = availableMessages.team.filter(msg => !currentTeamMessages.includes(msg));

      if (newOptions.length > 0) {
        const randomIndex = Math.floor(Math.random() * newOptions.length);
        const newMessage = newOptions[randomIndex];

        const messageElement = document.createElement('div');
        messageElement.className = 'p-2 rounded text-sm transition-all duration-900 opacity-0 transform translate-y-[-10px]';

        if (isAnyOptimizationActive) {
          messageElement.classList.add('bg-green-100', 'text-green-700');
        } else {
          messageElement.classList.add('bg-gray-200', 'text-gray-500');
        }

        messageElement.textContent = newMessage;

        if (teamContainer.firstChild) {
          teamContainer.insertBefore(messageElement, teamContainer.firstChild);
        } else {
          teamContainer.appendChild(messageElement);
        }

        setTimeout(() => {
          messageElement.classList.remove('opacity-0', 'transform', 'translate-y-[-10px]');
          messageElement.classList.add('opacity-100');
        }, 50);

        if (teamContainer.children.length > 4) {
          const oldestMessage = teamContainer.lastElementChild;
          if (oldestMessage) {
            oldestMessage.classList.add('opacity-0', 'transform', 'translate-y-[10px]');
            setTimeout(() => {
              oldestMessage.remove();
            }, 300);
          }
        }
      }
    }
  }

  function startMessageRotation() {
    if (messageIntervalId) {
      clearInterval(messageIntervalId);
    }

    messageIntervalId = setInterval(() => {
      updateDisplayedMessages();
    }, messageInterval) as unknown as number;
  }

  function stopMessageRotation() {
    if (messageIntervalId) {
      clearInterval(messageIntervalId);
      messageIntervalId = null;
    }
  }

  setDefaultMessages();
  updateDashboard();
</script>
